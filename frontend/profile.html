<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile â€¢ Fake Website Detector</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .page-container { max-width: 1100px; margin: 80px auto 48px; padding: 0 20px; }
    .page-header { display:flex; align-items:center; justify-content:space-between; gap: 16px; margin-bottom: 20px; }
    .nav { display:flex; gap:10px; }
    .nav a, .nav button { padding:10px 16px; border-radius: 10px; border:none; background:#1f2937; color:#fff; text-decoration:none; cursor:pointer; transition: transform .15s ease, background .15s ease; }
    .nav a:hover, .nav button:hover { background:#374151; transform: translateY(-1px); }
    .card { background:linear-gradient(180deg,#0b1220 0%, #0e1628 100%); color:#fff; border:1px solid #2b2f3a; border-radius:14px; padding:20px; box-shadow: 0 6px 18px rgba(0,0,0,.35); transition: transform .2s ease, box-shadow .2s ease; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,.45); }
    .row { margin-bottom: 14px; }
    .row label { display:block; margin-bottom:8px; font-weight:600; letter-spacing:.2px; }
    .row input { width:100%; padding:12px 14px; border-radius:10px; border:1px solid #2b2f3a; background:#0b1220; color:#e5e7eb; transition: border-color .15s ease, box-shadow .15s ease; outline: none; }
    .row input:focus { border-color:#0078ff; box-shadow: 0 0 0 3px rgba(0,120,255,.25); }
    .action { margin-top: 12px; display:flex; gap:10px; }
    .action button { padding:12px 16px; border:none; border-radius:10px; background:#0078ff; color:#fff; cursor:pointer; font-weight:600; transition: transform .15s ease, background .15s ease, box-shadow .15s ease; }
    .action button:hover { background:#005ecc; transform: translateY(-1px); box-shadow: 0 6px 14px rgba(0,120,255,.25); }
    .action button:active { transform: translateY(0); box-shadow: none; }
    .note { color:#9ca3af; margin-top:10px; font-size:.95rem; }
    .cards { display:flex; gap:24px; align-items:flex-start; }
    .cards .card { flex:1 1 0; }
    @media (max-width: 768px) { .cards { flex-direction: column; gap:16px; } }
  </style>
</head>
<body>
  <div class="page-container">
    <div class="page-header">
      <h1 style="margin:0; font-size: 1.4rem;">Profile</h1>
      <div class="nav">
        
        <button type="button" class="login-btn" onclick="window.location='dashboard.html'">Back</button>
      </div>
    </div>

    <div class="cards">
    <div class="card">
      <div class="row">
        <label for="fullname">Full Name</label>
        <input type="text" id="fullname" placeholder="Full Name" />
      </div>
      <div class="row">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Email" />
      </div>
      <div class="row">
        <label for="username">Username</label>
        <input type="text" id="username" placeholder="Username" readonly aria-readonly="true" />
      </div>
      <div class="action">
        <button type="button" onclick="updateProfile()">Update Info</button>
      </div>
      <div id="updateMsg" class="note"></div>
    </div>
    <div class="card">
      <div class="row">
        <label for="currentPassword">Current Password</label>
        <input type="password" id="currentPassword" placeholder="Current Password" />
      </div>
      <div class="row">
        <label for="newPassword">New Password</label>
        <input type="password" id="newPassword" placeholder="New Password" />
      </div>
      <div class="row">
        <label for="confirmPassword">Confirm New Password</label>
        <input type="password" id="confirmPassword" placeholder="Confirm New Password" />
      </div>
      <div class="action">
        <button type="button" onclick="updatePassword()">Update Password</button>
      </div>
      <div id="passwordMsg" class="note"></div>
    </div>
    </div>
  </div>

  <script>
    const API_BASE_URL = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
      ? 'http://localhost:5000'
      : 'https://your-app-name.onrender.com';
    function getAuthHeaders() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Session expired. Please log in again.');
        window.location.href = 'login.html';
        return null;
      }
      return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };
    }

    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('username');
      window.location.href = 'login.html';
    }

    async function loadUserProfile() {
      const headers = getAuthHeaders();
      if (!headers) return;
      try {
        const res = await fetch(`${API_BASE_URL}/api/auth/user/profile`, { headers });
        const data = await res.json();
        if (!res.ok) {
          console.error('Profile load error:', data);
          document.getElementById('updateMsg').textContent = data.error || data.message || 'Failed to load profile';
          return;
        }
        document.getElementById('fullname').value = data.fullname || '';
        document.getElementById('email').value = data.email || '';
        document.getElementById('username').value = data.username || '';
      } catch (e) {
        console.error('Error loading profile:', e);
        document.getElementById('updateMsg').textContent = 'Network error';
      }
    }

    async function updatePassword() {
      const headers = getAuthHeaders();
      if (!headers) return;
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const msg = document.getElementById('passwordMsg');
      msg.textContent = '';
      if (!currentPassword || !newPassword || !confirmPassword) { msg.textContent = 'All fields are required'; return; }
      if (newPassword !== confirmPassword) { msg.textContent = 'New passwords do not match'; return; }
      try {
        const res = await fetch(`${API_BASE_URL}/api/auth/user/password`, {
          method: 'PUT',
          headers,
          body: JSON.stringify({ currentPassword, newPassword })
        });
        const data = await res.json();
        msg.textContent = data.message || data.error || '';
        if (res.ok) {
          document.getElementById('currentPassword').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
        }
      } catch (e) {
        console.error('Password update error:', e);
        msg.textContent = 'Network error';
      }
    }

    async function updateProfile() {
      const headers = getAuthHeaders();
      if (!headers) return;
      const fullname = document.getElementById('fullname').value.trim();
      const email = document.getElementById('email').value.trim();
      try {
        const res = await fetch(`${API_BASE_URL}/api/auth/user/update`, {
          method: 'PUT',
          headers,
          body: JSON.stringify({ fullname, email })
        });
        const data = await res.json();
        document.getElementById('updateMsg').textContent = data.message || data.error || '';
        loadUserProfile();
      } catch (e) {
        console.error('Update error:', e);
        document.getElementById('updateMsg').textContent = 'Network error';
      }
    }

    window.addEventListener('DOMContentLoaded', function() {
      loadUserProfile();
    });
  </script>
</body>
</html>
